<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>jackdaw.serdes.avro documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Jackdaw</span> <span class="project-version">0.4.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jackdaw</span></div></div></li><li class="depth-2 branch"><a href="jackdaw.admin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>admin</span></div></a></li><li class="depth-2"><a href="jackdaw.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.client.log.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>log</span></div></a></li><li class="depth-3"><a href="jackdaw.client.partitioning.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>partitioning</span></div></a></li><li class="depth-2 branch"><a href="jackdaw.data.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>data</span></div></a></li><li class="depth-2"><a href="jackdaw.serdes.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>serdes</span></div></a></li><li class="depth-3 current"><a href="jackdaw.serdes.avro.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>avro</span></div></a></li><li class="depth-4"><a href="jackdaw.serdes.avro.schema-registry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema-registry</span></div></a></li><li class="depth-3"><a href="jackdaw.serdes.edn.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>edn</span></div></a></li><li class="depth-4"><a href="jackdaw.serdes.edn.nippy.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nippy</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.serdes.fn.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>fn</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.serdes.fn-impl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fn-impl</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.serdes.json.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>json</span></div></a></li><li class="depth-3"><a href="jackdaw.serdes.uuid.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>uuid</span></div></a></li><li class="depth-2 branch"><a href="jackdaw.specs.html"><div class="inner"><span class="tree" style="top: -269px;"><span class="top" style="height: 278px;"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2"><a href="jackdaw.streams.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>streams</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.configurable.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>configurable</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.configured.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>configured</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.extras.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>extras</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.interop.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>interop</span></div></a></li><li class="depth-3"><a href="jackdaw.streams.lambdas.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lambdas</span></div></a></li><li class="depth-4"><a href="jackdaw.streams.lambdas.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-3 branch"><a href="jackdaw.streams.protocols.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>protocols</span></div></a></li><li class="depth-3"><a href="jackdaw.streams.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-1"><a href="user.html"><div class="inner"><span class="tree" style="top: -765px;"><span class="top" style="height: 774px;"></span><span class="bottom"></span></span><span>user</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-.2Bbase-schema-type-registry.2B"><div class="inner"><span>+base-schema-type-registry+</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-.2BUUID-type-registry.2B"><div class="inner"><span>+UUID-type-registry+</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-avro-bytes.3F"><div class="inner"><span>avro-bytes?</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-avro-serde"><div class="inner"><span>avro-serde</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-class-name"><div class="inner"><span>class-name</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-int-castable.3F"><div class="inner"><span>int-castable?</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-int-range.3F"><div class="inner"><span>int-range?</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-make-coercion-stack"><div class="inner"><span>make-coercion-stack</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-parse-schema-str"><div class="inner"><span>parse-schema-str</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-SchemaCoercion"><div class="inner"><span>SchemaCoercion</span></div></a></li><li class="depth-2 branch"><a href="jackdaw.serdes.avro.html#var-avro-.3Eclj"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>avro-&gt;clj</span></div></a></li><li class="depth-2 branch"><a href="jackdaw.serdes.avro.html#var-clj-.3Eavro"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj-&gt;avro</span></div></a></li><li class="depth-2 branch"><a href="jackdaw.serdes.avro.html#var-match-avro.3F"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>match-avro?</span></div></a></li><li class="depth-2"><a href="jackdaw.serdes.avro.html#var-match-clj.3F"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>match-clj?</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-serialization-error-msg"><div class="inner"><span>serialization-error-msg</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-single-float.3F"><div class="inner"><span>single-float?</span></div></a></li><li class="depth-1"><a href="jackdaw.serdes.avro.html#var-validate-clj.21"><div class="inner"><span>validate-clj!</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">jackdaw.serdes.avro</h1><div class="doc"><pre class="plaintext">Generating Serdes mapping Clojure &lt;-&gt; Avro.

The intentional API of this NS has three main features -
`SchemaCoercion`, the intentional type registry (of which
`#'+base-schema-type-registry+` is an example) and
`#'avro-serde`.

`avro-serde` is the primary entry point to this namespace for
users. It's a function of a schema-registry configuration, a schema
type registry, and a serde configuration to be instantiated.

The intent is that an end user will `partial` the `avro-serde`
function with their schema registry details and desired type
registry, and use the `partial`'d function as en entry in a registry
as used by `jackdaw.serdes/serde`.

This allows `serdes` and `avro-serde` to be agnostic to application
or environment specific configuration details.

But what's this type registry?

Apache Avro "logical types" - a tool for annotating fields in an
avro record as having some complex interpretation beyond their
serialized format. The `type-registry` for the purposes of the
`avro-serde` function a mapping of addresses to functions which will
when invoked build and return a `SchemaCoercion` instance.

When a Serde is instantiated, a stack of `SchemaCoercion` coersion
helpers is built which will - given a simply deserialized Avro
record - walk its tree coercing its to Clojure types as defined by
the `SchemaCoercion` helpers.

The `SchemaCoercion` stack is built by statically inspecting the parsed
Avro schema, and using the type (if any) and potentially logical
type to select a handler in the `type-registry` which will, given a
function with which to recurse and the schema of that node, build
and return a `SchemaCoercion` handler.

This registry pattern is deliberately chosen so that Avro coercion
will be customizable by the user. As an example, the
`+UUID-type-registry+` is included, which defines a mapping from two
different logical UUID refinements of the binary string type to an
appropriate handler.

A user who wanted to opt into these handlers could simply call
`avro-serde` with
`(merge +base-schema-type-registry+ +UUID-type-registry+)`

Users are HIGHLY encouraged to use the `+base-schema-type-registry+`
as the base for their type registries, as it defines sane handlings
for all of Avro's fundamental types and most of its compounds.

</pre></div><div class="public anchor" id="var-.2Bbase-schema-type-registry.2B"><h3>+base-schema-type-registry+</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Provides handlers for all of Avro's fundamental types besides `fixed`.

Fixed is unsupported.</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L539">view source</a></div></div><div class="public anchor" id="var-.2BUUID-type-registry.2B"><h3>+UUID-type-registry+</h3><div class="usage"></div><div class="doc"><pre class="plaintext">A type constructor registry.

Provides the logical types `uuid` and `jackdaw.serdes.avro.UUID` coded as strings with coercion
to round-trip `java.util.UUID` instances.</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L567">view source</a></div></div><div class="public anchor" id="var-avro-bytes.3F"><h3>avro-bytes?</h3><div class="usage"></div><div class="doc"><pre class="plaintext">Returns true if the object is compatible with Avro bytes, false otherwise

* byte[] - Valid only as a top level schema type
* java.nio.ByteBuffer - Valid only as a nested type</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L163">view source</a></div></div><div class="public anchor" id="var-avro-serde"><h3>avro-serde</h3><div class="usage"><code>(avro-serde type-registry {:keys [avro.schema-registry/client avro.schema-registry/url], :as registry-config} {:keys [avro/schema avro/coercion-cache key?], :as topic-config})</code></div><div class="doc"><pre class="plaintext">Given a type and logical type registry, a schema registry config with
either a client or a URL and an Avro topic descriptor, build and
return a Serde instance.</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L583">view source</a></div></div><div class="public anchor" id="var-class-name"><h3>class-name</h3><div class="usage"><code>(class-name x)</code></div><div class="doc"><pre class="plaintext">Returns a human readable description of x's type
</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L126">view source</a></div></div><div class="public anchor" id="var-int-castable.3F"><h3>int-castable?</h3><div class="usage"><code>(int-castable? x)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L207">view source</a></div></div><div class="public anchor" id="var-int-range.3F"><h3>int-range?</h3><div class="usage"><code>(int-range? x)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L204">view source</a></div></div><div class="public anchor" id="var-make-coercion-stack"><h3>make-coercion-stack</h3><div class="usage"><code>(make-coercion-stack type-registry)</code></div><div class="doc"><pre class="plaintext">Given a registry mapping Avro type specs to 2-arity coercion
constructors, recursively build up a coercion stack which will go
clj &lt;-&gt; avro, returning the root coercion object.

(satisfies `SchemaCoercion`)</pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L99">view source</a></div></div><div class="public anchor" id="var-parse-schema-str"><h3>parse-schema-str</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L78">view source</a></div></div><div class="public anchor" id="var-SchemaCoercion"><h3>SchemaCoercion</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-avro-.3Eclj"><h3>avro-&gt;clj</h3><div class="usage"><code>(avro-&gt;clj schema-type avro-data)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-clj-.3Eavro"><h3>clj-&gt;avro</h3><div class="usage"><code>(clj-&gt;avro schema-type clj-data path)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-match-avro.3F"><h3>match-avro?</h3><div class="usage"><code>(match-avro? schema-type avro-data)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-match-clj.3F"><h3>match-clj?</h3><div class="usage"><code>(match-clj? schema-type clj-data)</code></div><div class="doc"><pre class="plaintext"></pre></div></div></div></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L118">view source</a></div></div><div class="public anchor" id="var-serialization-error-msg"><h3>serialization-error-msg</h3><div class="usage"><code>(serialization-error-msg x expected-type)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L134">view source</a></div></div><div class="public anchor" id="var-single-float.3F"><h3>single-float?</h3><div class="usage"><code>(single-float? x)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L192">view source</a></div></div><div class="public anchor" id="var-validate-clj.21"><h3>validate-clj!</h3><div class="usage"><code>(validate-clj! this x path expected-type)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="http://github.com/fundingcircle/jackdaw/blob/0.4.0-SNAPSHOT/src/jackdaw/serdes/avro.clj#L139">view source</a></div></div></div></body></html>